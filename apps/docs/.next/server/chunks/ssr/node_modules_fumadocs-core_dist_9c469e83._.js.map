{"version":3,"sources":["../../../../../../node_modules/fumadocs-core/src/search/index.ts","../../../../../../node_modules/fumadocs-core/src/search/client/algolia.ts"],"sourcesContent":["import type { ReactNode } from 'react';\n\nexport interface SortedResult<Content = string> {\n  id: string;\n  url: string;\n  type: 'page' | 'heading' | 'text';\n  content: Content;\n\n  /**\n   * breadcrumbs to be displayed on UI\n   */\n  breadcrumbs?: Content[];\n  contentWithHighlights?: HighlightedText<Content>[];\n}\n\nexport type ReactSortedResult = SortedResult<ReactNode>;\n\nexport interface HighlightedText<Content = string> {\n  type: 'text';\n  content: Content;\n  styles?: {\n    highlight?: boolean;\n  };\n}\n\nfunction escapeRegExp(input: string): string {\n  return input.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction buildRegexFromQuery(q: string): RegExp | null {\n  const trimmed = q.trim();\n  if (trimmed.length === 0) return null;\n  const terms = Array.from(\n    new Set(\n      trimmed\n        .split(/\\s+/)\n        .map((t) => t.trim())\n        .filter(Boolean),\n    ),\n  );\n  if (terms.length === 0) return null;\n  const escaped = terms.map(escapeRegExp).join('|');\n  return new RegExp(`(${escaped})`, 'gi');\n}\n\nexport function createContentHighlighter(query: string | RegExp) {\n  const regex = typeof query === 'string' ? buildRegexFromQuery(query) : query;\n\n  return {\n    highlight(content: string): HighlightedText[] {\n      if (!regex) return [{ type: 'text', content }];\n      const out: HighlightedText[] = [];\n\n      let i = 0;\n      for (const match of content.matchAll(regex)) {\n        if (i < match.index) {\n          out.push({\n            type: 'text',\n            content: content.substring(i, match.index),\n          });\n        }\n\n        out.push({\n          type: 'text',\n          content: match[0],\n          styles: {\n            highlight: true,\n          },\n        });\n\n        i = match.index + match[0].length;\n      }\n\n      if (i < content.length) {\n        out.push({\n          type: 'text',\n          content: content.substring(i),\n        });\n      }\n\n      return out;\n    },\n  };\n}\n","import type { BaseIndex } from '@/search/algolia';\nimport type { Hit, LiteClient, SearchResponse } from 'algoliasearch/lite';\nimport { createContentHighlighter, type SortedResult } from '@/search';\n\nexport interface AlgoliaOptions {\n  indexName: string;\n  client: LiteClient;\n\n  /**\n   * Filter results with specific tag.\n   */\n  tag?: string;\n\n  locale?: string;\n\n  onSearch?: (\n    query: string,\n    tag?: string,\n    locale?: string,\n  ) => Promise<{\n    results: SearchResponse<BaseIndex>[];\n  }>;\n}\n\nexport function groupResults(hits: Hit<BaseIndex>[]): SortedResult[] {\n  const grouped: SortedResult[] = [];\n  const scannedUrls = new Set<string>();\n\n  for (const hit of hits) {\n    if (!scannedUrls.has(hit.url)) {\n      scannedUrls.add(hit.url);\n\n      grouped.push({\n        id: hit.url,\n        type: 'page',\n        breadcrumbs: hit.breadcrumbs,\n        url: hit.url,\n        content: hit.title,\n      });\n    }\n\n    grouped.push({\n      id: hit.objectID,\n      type: hit.content === hit.section ? 'heading' : 'text',\n      url: hit.section_id ? `${hit.url}#${hit.section_id}` : hit.url,\n      content: hit.content,\n    });\n  }\n\n  return grouped;\n}\n\nexport async function searchDocs(\n  query: string,\n  { indexName, onSearch, client, locale, tag }: AlgoliaOptions,\n): Promise<SortedResult[]> {\n  if (query.trim().length === 0) return [];\n\n  const result = onSearch\n    ? await onSearch(query, tag, locale)\n    : await client.searchForHits<BaseIndex>({\n        requests: [\n          {\n            type: 'default',\n            indexName,\n            query,\n            distinct: 5,\n            hitsPerPage: 10,\n            filters: tag ? `tag:${tag}` : undefined,\n          },\n        ],\n      });\n\n  const highlighter = createContentHighlighter(query);\n  return groupResults(result.results[0].hits).flatMap((hit) => {\n    if (hit.type === 'page') {\n      return {\n        ...hit,\n        contentWithHighlights: hit.contentWithHighlights ?? highlighter.highlight(hit.content),\n      };\n    }\n\n    return [];\n  });\n}\n"],"names":[],"mappings":"uCAyBA,SAAS,EAAa,CAAA,EAAuB,AAC3C,OAAO,EAAM,OAAA,CAAQ,sBAAuB,OAAO,CAmBrD,SAAgB,EAAyB,CAAA,EAAwB,AAC/D,IAAM,EAAQ,AAAiB,iBAAV,EAjBvB,AAiB4C,SAjBnC,AAAoB,CAAA,EAA0B,AACrD,IAAM,EAAU,EAAE,IAAA,EAAM,CACxB,GAAuB,AAAnB,EAAsB,IAAd,MAAA,CAAc,OAAO,KACjC,IAAM,EAAQ,MAAM,IAAA,CAClB,IAAI,IACF,EACG,KAAA,CAAM,MAAM,CACZ,GAAA,CAAA,AAAK,GAAM,EAAE,IAAA,EAAM,CAAC,CACpB,MAAA,CAAO,QAAQ,CACnB,CACF,CACD,GAAqB,EAAG,EAApB,EAAM,MAAA,CAAc,OAAO,KAC/B,IAAM,EAAU,EAAM,GAAA,CAAI,GAAc,IAAA,CAAK,IAAI,CAAV,AACvC,OAAO,AAAI,OAAO,CAAA,CAAA,EAAI,EAAQ,CAAA,CAAA,CAAI,KAAK,EAIuB,GAAS,EAEvE,CAFoE,KAE7D,CACL,UAAU,CAAA,EAAoC,AAC5C,GAAI,CAAC,EAAO,IAAA,EAAO,CAAC,CAAE,KAAM,eAAQ,EAAS,CAAC,CAC9C,IAAM,EAAyB,EAAE,CAE7B,EAAI,EACR,IAAK,IAAM,KAAS,EAAQ,QAAA,CAAS,GAC/B,EAAI,CADiC,CAAE,AAC7B,KAAA,CACZ,CAAA,EAAI,IAAA,CAAK,CACP,KAAM,OACN,QAAS,EAAQ,SAAA,CAAU,EAAG,EAAM,KAAA,CAAM,CAC3C,CAAC,CAGJ,EAAI,IAAA,CAAK,CACP,KAAM,OACN,QAAS,CAAA,CAAM,EAAA,CACf,OAAQ,CACN,WAAW,CAAA,CACZ,CACF,CAAC,CAEF,EAAI,EAAM,KAAA,CAAQ,CAAA,CAAM,EAAA,CAAG,MAAA,CAU7B,OAPI,EAAI,EAAQ,MAAA,CACd,CAAA,EAAI,IAAA,CAAK,CACP,KAAM,OACN,QAAS,EAAQ,SAAA,CAAU,EAAE,CAC9B,CAAC,CAGG,GAEV,2DC9BH,eAAsB,EACpB,CAAA,CACA,WAAE,CAAA,UAAW,CAAA,QAAU,CAAA,QAAQ,CAAA,KAAQ,CAAA,CAAA,EACd,AACzB,GAA4B,EAAG,EAA3B,EAAM,IAAA,EAAM,CAAC,MAAA,CAAc,MAAO,EAAE,CAExC,IAAM,EAAS,EACX,MAAM,EAAS,EAAO,EAAK,GAC3B,IADkC,EAC5B,EAAO,aAAA,CAAyB,CACpC,SAAU,CACR,CACE,KAAM,oBACN,QACA,EACA,SAAU,EACV,YAAa,GACb,QAAS,EAAM,CAAA,IAAA,EAAO,EAAA,CAAA,CAAQ,KAAA,EAC/B,CACF,CACF,CAAC,CAEA,EAAA,CAAA,EAAc,EAAA,CAAA,EAAyB,GAC7C,GADmD,GAC5C,CAlDT,SAAgB,AAAa,CAAA,EAAwC,AACnE,IAAM,EAA0B,EAAE,CAC5B,EAAc,IAAI,IAExB,CAFqC,GAA/B,AAED,IAAM,KAAO,EACX,EAHD,AAGa,CADK,EACL,CAAI,EAAI,GAAA,CAAI,EAAE,CAC7B,EAAY,GAAA,CAAI,EAAI,GAAA,CAAI,CAExB,EAAQ,IAAA,CAAK,CACX,GAAI,EAAI,GAAA,CACR,KAAM,OACN,YAAa,EAAI,WAAA,CACjB,IAAK,EAAI,GAAA,CACT,QAAS,EAAI,KAAA,CACd,CAAC,EAGJ,EAAQ,IAAA,CAAK,CACX,GAAI,EAAI,QAAA,CACR,KAAM,EAAI,OAAA,GAAY,EAAI,OAAA,CAAU,UAAY,OAChD,IAAK,EAAI,UAAA,CAAa,CAAA,EAAG,EAAI,GAAA,CAAI,CAAA,EAAG,EAAI,UAAA,CAAA,CAAA,CAAe,EAAI,GAAA,CAC3D,QAAS,EAAI,OAAA,CACd,CAAC,CAGJ,OAAO,IAyBa,EAAO,OAAA,CAAQ,EAAA,CAAG,IAAA,CAAK,CAAC,OAAA,CAAA,AAAS,GACnD,AAAI,AAAa,KAD0C,EAEzD,CAAA,GADM,IAAA,CACC,CACL,GAAG,CAAA,CACH,sBAAuB,EAAI,qBAAA,EAAyB,EAAY,SAAA,CAAU,EAAI,OAAA,CAAQ,CACvF,CAGI,EAAE"}