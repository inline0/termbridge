{"version":3,"sources":["../../../../../../node_modules/fumadocs-core/src/search/index.ts","../../../../../../node_modules/fumadocs-core/src/utils/remove-undefined.ts","../../../../../../node_modules/fumadocs-core/src/search/client/orama-cloud-legacy.ts"],"sourcesContent":["import type { ReactNode } from 'react';\n\nexport interface SortedResult<Content = string> {\n  id: string;\n  url: string;\n  type: 'page' | 'heading' | 'text';\n  content: Content;\n\n  /**\n   * breadcrumbs to be displayed on UI\n   */\n  breadcrumbs?: Content[];\n  contentWithHighlights?: HighlightedText<Content>[];\n}\n\nexport type ReactSortedResult = SortedResult<ReactNode>;\n\nexport interface HighlightedText<Content = string> {\n  type: 'text';\n  content: Content;\n  styles?: {\n    highlight?: boolean;\n  };\n}\n\nfunction escapeRegExp(input: string): string {\n  return input.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction buildRegexFromQuery(q: string): RegExp | null {\n  const trimmed = q.trim();\n  if (trimmed.length === 0) return null;\n  const terms = Array.from(\n    new Set(\n      trimmed\n        .split(/\\s+/)\n        .map((t) => t.trim())\n        .filter(Boolean),\n    ),\n  );\n  if (terms.length === 0) return null;\n  const escaped = terms.map(escapeRegExp).join('|');\n  return new RegExp(`(${escaped})`, 'gi');\n}\n\nexport function createContentHighlighter(query: string | RegExp) {\n  const regex = typeof query === 'string' ? buildRegexFromQuery(query) : query;\n\n  return {\n    highlight(content: string): HighlightedText[] {\n      if (!regex) return [{ type: 'text', content }];\n      const out: HighlightedText[] = [];\n\n      let i = 0;\n      for (const match of content.matchAll(regex)) {\n        if (i < match.index) {\n          out.push({\n            type: 'text',\n            content: content.substring(i, match.index),\n          });\n        }\n\n        out.push({\n          type: 'text',\n          content: match[0],\n          styles: {\n            highlight: true,\n          },\n        });\n\n        i = match.index + match[0].length;\n      }\n\n      if (i < content.length) {\n        out.push({\n          type: 'text',\n          content: content.substring(i),\n        });\n      }\n\n      return out;\n    },\n  };\n}\n","export function removeUndefined<T extends object>(value: T, deep = false): T {\n  const obj = value as Record<string, unknown>;\n\n  for (const key in obj) {\n    if (obj[key] === undefined) delete obj[key];\n    if (!deep) continue;\n\n    const entry = obj[key];\n\n    if (typeof entry === 'object' && entry !== null) {\n      removeUndefined(entry, deep);\n      continue;\n    }\n\n    if (Array.isArray(entry)) {\n      for (const item of entry) removeUndefined(item, deep);\n    }\n  }\n\n  return value;\n}\n","import type { ClientSearchParams, OramaClient } from '@oramacloud/client';\nimport { removeUndefined } from '@/utils/remove-undefined';\nimport type { OramaIndex } from '@/search/orama-cloud-legacy';\nimport { createContentHighlighter, type SortedResult } from '@/search';\n\ninterface CrawlerIndex {\n  path: string;\n  title: string;\n  content: string;\n  section: string;\n  category: string;\n}\n\nexport interface OramaCloudLegacyOptions {\n  client: OramaClient;\n  /**\n   * The type of your index.\n   *\n   * You can set it to `crawler` if you use crawler instead of the JSON index with schema provided by Fumadocs\n   */\n  index?: 'default' | 'crawler';\n  params?: ClientSearchParams;\n\n  /**\n   * Filter results with specific tag.\n   */\n  tag?: string;\n\n  /**\n   * Filter by locale (unsupported at the moment)\n   */\n  locale?: string;\n}\n\nexport async function searchDocs(\n  query: string,\n  options: OramaCloudLegacyOptions,\n): Promise<SortedResult[]> {\n  const highlighter = createContentHighlighter(query);\n  const list: SortedResult[] = [];\n  const { index = 'default', client, params: extraParams = {}, tag } = options;\n\n  if (index === 'crawler') {\n    const result = await client.search({\n      ...extraParams,\n      term: query,\n      where: {\n        category: tag\n          ? {\n              eq: tag.slice(0, 1).toUpperCase() + tag.slice(1),\n            }\n          : undefined,\n        ...extraParams.where,\n      },\n      limit: 10,\n    });\n    if (!result) return list;\n\n    for (const hit of result.hits) {\n      const doc = hit.document as unknown as CrawlerIndex;\n\n      list.push(\n        {\n          id: hit.id,\n          type: 'page',\n          content: doc.title,\n          contentWithHighlights: highlighter.highlight(doc.title),\n          url: doc.path,\n        },\n        {\n          id: 'page' + hit.id,\n          type: 'text',\n          content: doc.content,\n          contentWithHighlights: highlighter.highlight(doc.content),\n          url: doc.path,\n        },\n      );\n    }\n\n    return list;\n  }\n\n  const params: ClientSearchParams = {\n    ...extraParams,\n    term: query,\n    where: removeUndefined({\n      tag,\n      ...extraParams.where,\n    }),\n    groupBy: {\n      properties: ['page_id'],\n      maxResult: 7,\n      ...extraParams.groupBy,\n    },\n  };\n\n  const result = await client.search(params);\n  if (!result || !result.groups) return list;\n\n  for (const item of result.groups) {\n    let addedHead = false;\n\n    for (const hit of item.result) {\n      const doc = hit.document as unknown as OramaIndex;\n\n      if (!addedHead) {\n        list.push({\n          id: doc.page_id,\n          type: 'page',\n          content: doc.title,\n          breadcrumbs: doc.breadcrumbs,\n          contentWithHighlights: highlighter.highlight(doc.title),\n          url: doc.url,\n        });\n        addedHead = true;\n      }\n\n      list.push({\n        id: doc.id,\n        content: doc.content,\n        contentWithHighlights: highlighter.highlight(doc.content),\n        type: doc.content === doc.section ? 'heading' : 'text',\n        url: doc.section_id ? `${doc.url}#${doc.section_id}` : doc.url,\n      });\n    }\n  }\n\n  return list;\n}\n"],"names":["result"],"mappings":"uCAyBA,SAAS,EAAa,CAAA,EAAuB,AAC3C,OAAO,EAAM,OAAA,CAAQ,sBAAuB,OAAO,CAmBrD,SAAgB,EAAyB,CAAA,EACvC,AAD+D,IACzD,EAAyB,UAAjB,OAAO,EAjBvB,AAiB4C,SAjBnC,AAAoB,CAAA,EAA0B,AACrD,IAAM,EAAU,EAAE,IAAA,EAAM,CACxB,GAAuB,EAAG,EAAtB,EAAQ,MAAA,CAAc,OAAO,KACjC,IAAM,EAAQ,MAAM,IAAA,CAClB,IAAI,IACF,EACG,KAAA,CAAM,MAAM,CACZ,GAAA,CAAA,AAAK,GAAM,EAAE,IAAA,EAAM,CAAC,CACpB,MAAA,CAAO,QAAQ,CACnB,CACF,CACD,GAAqB,EAAG,EAApB,EAAM,MAAA,CAAc,OAAO,KAC/B,IAAM,EAAU,EAAM,GAAA,CAAI,GAAc,IAAA,CAAK,IAAI,CACjD,AADuC,OAChC,AAAI,OAAO,CAAA,CAAA,EAAI,EAAQ,CAAA,CAAA,CAAI,KAAK,EAIuB,GAAS,EAEvE,CAFoE,KAE7D,CACL,UAAU,CAAA,EAAoC,AAC5C,GAAI,CAAC,EAAO,IAAA,EAAO,CAAC,CAAE,KAAM,eAAQ,EAAS,CAAC,CAC9C,IAAM,EAAyB,EAAE,CAE7B,EAAI,EACR,IAAK,IAAM,KAAS,EAAQ,QAAA,CAAS,GAC/B,EAAI,CADiC,CAAE,AAC7B,KAAA,CACZ,CAAA,EAAI,IAAA,CAAK,CACP,KAAM,OACN,QAAS,EAAQ,SAAA,CAAU,EAAG,EAAM,KAAA,CAAM,CAC3C,CAAC,CAGJ,EAAI,IAAA,CAAK,CACP,KAAM,OACN,QAAS,CAAA,CAAM,EAAA,CACf,OAAQ,CACN,WAAW,CAAA,CACZ,CACF,CAAC,CAEF,EAAI,EAAM,KAAA,CAAQ,CAAA,CAAM,EAAA,CAAG,MAAA,CAU7B,OAPI,EAAI,EAAQ,MAAA,CACd,CAAA,EAAI,IAAA,CAAK,CACP,KAAM,OACN,QAAS,EAAQ,SAAA,CAAU,EAAE,CAC9B,CAAC,CAGG,GAEV,uDClFH,SAAgB,EAAkC,CAAA,CAAU,GAAO,CAAA,EAAU,AAG3E,IAAK,IAAM,OAAO,AAAK,CAErB,GADiB,KAAA,EAAW,EAAxB,CAAA,CAAI,EAAA,EAAoB,OAAO,CAAA,CAAI,EAAA,CACnC,CAAC,EAAM,GAAA,MAEX,IAAM,EAAQ,AANJ,CAMI,CAAI,EAAA,CAElB,GAAqB,UAAjB,OAAO,GAAgC,OAAV,EAAgB,CAC/C,EAAgB,EAAO,GACvB,EAD4B,OAI9B,GAAI,MAAM,OAAA,CAAQ,GAChB,GADsB,CACtB,AAAK,IAAM,KAAQ,EAAO,EAAgB,EAAM,GAIpD,EAJyD,KAIlD,2DCeT,eAAsB,EACpB,CAAA,CACA,CAAA,EACyB,AACzB,IAAM,EAAA,CAAA,EAAc,EAAA,CAAA,EAAyB,GACvC,EAAuB,CADsB,CACpB,CACzB,CAAE,QAAQ,SAAA,QAAW,CAAA,CAAQ,OAAQ,EAAc,CAAA,CAAE,KAAE,CAAA,CAAA,CAAQ,EAErE,GAAc,YAAV,EAAqB,CACvB,IAAMA,EAAS,MAAM,EAAO,MAAA,CAAO,CACjC,GAAG,CAAA,CACH,KAAM,EACN,MAAO,CACL,SAAU,EACN,CACE,GAAI,EAAI,KAAA,CAAM,EAAG,EAAE,CAAC,WAAA,EAAa,CAAG,EAAI,KAAA,CAAM,EAAE,CACjD,CACD,KAAA,EACJ,GAAG,EAAY,KAAA,CAChB,CACD,MAAO,GACR,CAAC,CACF,GAAI,CAACA,EAAQ,OAAO,AAAP,EAEb,IAAK,IAAM,KAAOA,EAAO,IAAA,CAAM,CAC7B,IAAM,EAAM,EAAI,QAAA,CAEhB,EAAK,IAAA,CACH,CACE,GAAI,EAAI,EAAA,CACR,KAAM,OACN,QAAS,EAAI,KAAA,CACb,sBAAuB,EAAY,SAAA,CAAU,EAAI,KAAA,CAAM,CACvD,IAAK,EAAI,IAAA,CACV,CACD,CACE,GAAI,OAAS,EAAI,EAAA,CACjB,KAAM,OACN,QAAS,EAAI,OAAA,CACb,sBAAuB,EAAY,SAAA,CAAU,EAAI,OAAA,CAAQ,CACzD,IAAK,EAAI,IAAA,CACV,CACF,CAGH,OAAO,EAGT,IAAM,EAA6B,CACjC,GAAG,CAAA,CACH,KAAM,EACN,MAAA,CAAA,EAAO,EAAA,CAAA,EAAgB,KACrB,EACA,GAAG,EAAY,KAAA,CAChB,CAAC,CACF,QAAS,CACP,WAAY,CAAC,UAAU,CACvB,UAAW,EACX,GAAG,EAAY,OAAA,CAChB,CACF,CAEK,EAAS,MAAM,EAAO,MAAA,CAAO,GACnC,GAAI,CADsC,AACrC,GAAU,CAAC,EAAO,MAAA,CAAQ,OAAO,EAEtC,IAAK,IAAM,KAAQ,EAAO,MAAA,CAAQ,CAChC,IAAI,GAAY,EAEhB,IAAK,IAAM,KAAO,EAAK,MAAA,CAAQ,CAC7B,IAAM,EAAM,EAAI,QAAA,CAEX,IACH,EAAK,IAAA,CADS,AACJ,CACR,GAAI,EAAI,OAAA,CACR,KAAM,OACN,QAAS,EAAI,KAAA,CACb,YAAa,EAAI,WAAA,CACjB,sBAAuB,EAAY,SAAA,CAAU,EAAI,KAAA,CAAM,CACvD,IAAK,EAAI,GAAA,CACV,CAAC,CACF,GAAY,GAGd,EAAK,IAAA,CAAK,CACR,GAAI,EAAI,EAAA,CACR,QAAS,EAAI,OAAA,CACb,sBAAuB,EAAY,SAAA,CAAU,EAAI,OAAA,CAAQ,CACzD,KAAM,EAAI,OAAA,GAAY,EAAI,OAAA,CAAU,UAAY,OAChD,IAAK,EAAI,UAAA,CAAa,CAAA,EAAG,EAAI,GAAA,CAAI,CAAA,EAAG,EAAI,UAAA,CAAA,CAAA,CAAe,EAAI,GAAA,CAC5D,CAAC,EAIN,OAAO"}